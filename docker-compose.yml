services:
  redeployment-service:
    build: .
    ports:
      - "184.107.141.137:3000:3000"
    # Run as root to match repository ownership
    volumes:
      # Mount SSH keys for GitHub access
      - ~/.ssh:/root/.ssh:ro
      # Mount apps directory (parent directory of redeployment-service)
      - ~/apps:/apps:rw
      # Mount Docker socket for Docker operations
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - NODE_ENV=production
    env_file:
      - .env
    restart: unless-stopped
